<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 
//====================================================================
// Project Name：巨星科技-土猫网最新Mybatis 架构版本    @Author Royal
// date:  2018-7-5 16:37:44
//====================================================================
!-->
<mapper namespace="com.toolmall.business.product.dao.PcProductCategoryResBackMapper">
	<resultMap id="RMPcProductCategoryResBack" type="com.toolmall.business.product.bean.PcProductCategoryResBack">
        <result property="id" column="id"/>
        <result property="frontCategoryId" column="front_category_id"/>
        <result property="backCategoryId" column="back_category_id"/>
	</resultMap>
	
	<resultMap id="RMPcProductCategory" type="com.toolmall.business.product.bean.PcProductCategory">
        <result property="categoryId" column="category_id"/>
        <result property="contentId" column="content_id"/>
        <result property="categoryName" column="category_name"/>
        <result property="categoryDescription" column="category_description"/>
        <result property="parentId" column="parent_id"/>
        <result property="categoryOrder" column="category_order"/>
        <result property="categoryUrl" column="category_url"/>
        <result property="urlFirst" column="url_first"/>
        <result property="urlSecond" column="url_second"/>
        <result property="isVisible" column="is_visible"/>
        <result property="createTime" column="create_time"/>
        <result property="modifyTime" column="modify_time"/>
        <result property="categoryGrade" column="category_grade"/>
        <result property="seoTitle" column="seo_title"/>
        <result property="seoKeywords" column="seo_keywords"/>
        <result property="seoDescription" column="seo_description"/>
        <result property="contentNames" column="contentNames"/>
        <result property="backCategoryNames" column="backCategoryNames"/>
        <result property="pageName" column="page_name"/>
	</resultMap>
	
	<resultMap id="RMPcProductCategoryBack" type="com.toolmall.business.product.bean.PcProductCategoryBack">
        <result property="categoryId" column="category_id"/>
        <result property="categoryName" column="category_name"/>
        <result property="categoryDescription" column="category_description"/>
        <result property="parentId" column="parent_id"/>
        <result property="categoryOrder" column="category_order"/>
        <result property="categoryGrade" column="category_grade"/>
		<result property="isLeaf" column="is_leaf"/>
		<result property="isVisible" column="is_visible"/>
        <result property="createTime" column="create_time"/>
        <result property="modifyTime" column="modify_time"/>
        <result property="contentIdAndCategoryNames" column="contentIdAndCategoryNames"/>
	</resultMap>

    <select id="selectPageList" resultMap="RMPcProductCategoryResBack"  >
        SELECT * FROM pc_product_category_res_back
       <include refid="findPagewhere"/>
    </select>

    <select id="selectPageCount" resultType="long"  >
        SELECT count(*) FROM pc_product_category_res_back 
		<include refid="findPagewhere"/>    
    </select>
    
    <select id="search" parameterType="com.toolmall.business.product.bean.PcProductCategoryResBack" resultMap="RMPcProductCategoryResBack">
        SELECT * FROM pc_product_category_res_back
        <include refid="searchWhere"/>
    </select>
	
	<select id="selectOne" resultMap="RMPcProductCategoryResBack"  >
        SELECT * FROM pc_product_category_res_back
       <include refid="findPagewhere"/>
    </select>
	
	<select id="selectList" resultMap="RMPcProductCategoryResBack"  >
        SELECT * FROM pc_product_category_res_back
       <include refid="findPagewhere"/>
    </select>
	    
    <select id="selectById" resultMap="RMPcProductCategoryResBack"  >
		SELECT *
	    <![CDATA[
		    FROM pc_product_category_res_back 
	        WHERE 
		        id = #{id} 
	    ]]>
	</select>
	
    <!-- useGeneratedKeys="true" keyProperty="xxx" for sqlserver and mysql -->
    <insert id="insert" parameterType="com.toolmall.business.product.bean.PcProductCategoryResBack"   useGeneratedKeys="true" keyProperty="id">
        INSERT INTO pc_product_category_res_back (
        	front_category_id ,
        	back_category_id 
        ) VALUES (
        	#{frontCategoryId} ,
        	#{backCategoryId} 
        )
	
	<!--
		oracle: order="BEFORE" SELECT sequenceName.nextval AS ID FROM DUAL 
		DB2: order="BEFORE"" values nextval for sequenceName
		<selectKey resultType="java.lang.Long" order="BEFORE" keyProperty="userId">
			SELECT sequenceName.nextval AS ID FROM DUAL 
        </selectKey>
	-->
	</insert>
    
	<insert id="insertByBatch" parameterType="java.util.List" >
        INSERT INTO pc_product_category_res_back (
        	front_category_id ,
        	back_category_id 
        )VALUES
        <foreach collection="list" item="item" index="index" separator=",">
		(
        	#{item.frontCategoryId} ,
        
        	#{item.backCategoryId} 
        )
        </foreach>
    </insert>
	
	<update id="update" parameterType="com.toolmall.business.product.bean.PcProductCategoryResBack" >
        UPDATE pc_product_category_res_back
        <trim prefix="SET" prefixOverrides="," suffixOverrides=",">
			<if test="frontCategoryId!=null">
	        front_category_id = #{frontCategoryId} ,
	        </if>
			<if test="backCategoryId!=null">
	        back_category_id = #{backCategoryId} 
	        </if>
	    </trim>    
        WHERE 
	       id = #{id} 
	</update>

	<update id="updateList" parameterType="java.util.List" >  
       UPDATE pc_product_category_res_back SET state = '0' WHERE id IN  
       <foreach collection="list" item="id" open="(" separator="," close=")">  
#{id}       </foreach>  
    </update>

    <delete id="delete" >
        DELETE FROM pc_product_category_res_back WHERE
        id = #{id} 
    </delete>
	
	<delete id="deleteByIds" >
        DELETE FROM pc_product_category_res_back WHERE
        id IN
        <foreach collection="ids" item="item" index="index" open="(" close=")" separator=",">
#{item}        </foreach>
    </delete>
	
	<sql id="findPagewhere">
		<where>	      
			 <if test="id!=null">
	         AND id = #{id} 
	         </if>
			 <if test="frontCategoryId!=null">
	         AND front_category_id = #{frontCategoryId} 
	         </if>
			 <if test="backCategoryId!=null">
	         AND back_category_id = #{backCategoryId} 
	         </if>
		</where>
	</sql>
	
    <sql id="searchWhere">
		<where>	      
		</where>
	</sql>
	
	<sql id="findDatewhere">
		<where>	      				
	       <if test="id!=null">
				AND id = #{id}
		   </if>
	       <if test="frontCategoryId!=null">
				AND front_category_id = #{frontCategoryId}
		   </if>
	       <if test="backCategoryId!=null">
				AND back_category_id = #{backCategoryId}
		   </if>
		</where>
	</sql>
	
	<!-- 调用存储过程
	<select id="selectUserByProvinceAndCity" resultMap="BaseResultMap"  
        statementType="CALLABLE">  带 井号
        {CALL user_selectUserByCity_sp({provinceId,mode=IN,jdbcType=INTEGER},{cityId,mode=IN,jdbcType=INTEGER},{pageIndex,mode=IN,jdbcType=INTEGER},{pageSize,mode=IN,jdbcType=INTEGER})}  
    </select>  
	-->
	
	<delete id="deleteByFrontCategoryId" >
        DELETE FROM pc_product_category_res_back WHERE
        front_category_id = #{categoryId} 
    </delete>
    
    <select id="getFrontCategoryByBack" resultMap="RMPcProductCategory" parameterType="java.lang.Long">
    	SELECT b.* FROM pc_product_category_res_back a, pc_product_category b 
    	WHERE a.front_category_id = b.category_id AND a.back_category_id = #{backCategoryId} AND a.is_deleted = 0 AND b.is_deleted = 0 ORDER BY a.create_time limit 1
    </select>
    
    <select id="getBackCategoryListByFront" resultMap="RMPcProductCategory" parameterType="java.lang.Long">
    	SELECT b.* FROM pc_product_category_res_back a, pc_product_category_back b 
    	WHERE a.back_category_id = b.category_id AND a.front_category_id = #{fontCategoryId} AND a.is_deleted = 0 AND b.is_deleted = 0 ORDER BY a.create_time
    </select>

    <select id="batchGetFrontCategoryByBack" resultType="com.toolmall.business.product.vo.ProductCategoryResBackVO">
    	SELECT b.category_id AS frontCategoryId,b.category_name AS frontCategoryName,a.back_category_id AS backCategoryId
        FROM pc_product_category_res_back a, pc_product_category b
    	WHERE a.front_category_id = b.category_id
        <if test="list != null and list.size() > 0">
            AND a.back_category_id IN
            <foreach collection="list" item="id" open="(" close=")" separator="," index="index">
               #{id}
            </foreach>
        </if>
    	AND a.is_deleted = 0 AND b.is_deleted = 0 ORDER BY a.create_time
    </select>

</mapper>

